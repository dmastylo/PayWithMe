$(function()
{
    // Event-show-page specific
    if ($('.messages').length > 0)
    {
        // set first message to latest-message
        $(".message:first-child").addClass("latest");

        // Poll for new messages
        setTimeout(updateMessages, <%= Figaro.env.chat_polling.to_i %>);
    }
});


function updateMessages()
{
    var event_id = $(".messages").attr("data-id");
    var after = $(".message").length > 0
              ? $(".messages").find(".latest.message").attr("data-time")
              : "0";
    $.getScript("/messages.js?event_id=" + event_id + "&after=" + after);

    setTimeout(updateMessages, <%= Figaro.env.chat_polling.to_i %>);
}